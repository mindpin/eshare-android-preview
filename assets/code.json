[["ident","require"],["space"," "],["delimiter","'"],["content","rubygems"],["delimiter","'"],["space","\n"],["ident","require"],["space"," "],["delimiter","'"],["content","nokogiri"],["delimiter","'"],["space","\n"],["space","\n"],["keyword","class"],["space"," "],["class","Set"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":origin_id"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":id"],["operator",","],["space"," "],["symbol",":name"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":parents"],["operator",","],["space"," "],["symbol",":children"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":deep"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","initialize"],["operator","("],["ident","id"],["operator",","],["space"," "],["ident","xml_group"],["operator",")"],["space","\n"],["space","    "],["instance_variable","@origin_id"],["space"," "],["operator","="],["space"," "],["ident","xml_group"],["operator","["],["delimiter","'"],["content","id"],["delimiter","'"],["operator","]"],["space","\n"],["space","    "],["instance_variable","@id"],["space"," "],["operator","="],["space"," "],["ident","id"],["space","\n"],["space","    "],["instance_variable","@name"],["space"," "],["operator","="],["space"," "],["ident","xml_group"],["operator","."],["ident","at_css"],["operator","("],["delimiter","'"],["content","y|NodeLabel"],["delimiter","'"],["operator",")"],["operator","."],["ident","inner_html"],["space","\n"],["space","\n"],["space","    "],["instance_variable","@parents"],["space"," "],["operator","="],["space"," "],["operator","["],["operator","]"],["space","\n"],["space","    "],["instance_variable","@children"],["space"," "],["operator","="],["space"," "],["operator","["],["operator","]"],["space","\n"],["space","\n"],["space","    "],["instance_variable","@deep"],["space"," "],["operator","="],["space"," "],["integer","1"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","build"],["operator","("],["ident","builder"],["operator",","],["space"," "],["operator","&"],["ident","block"],["operator",")"],["space","\n"],["space","    "],["ident","builder"],["operator","."],["ident","set"],["operator","("],["symbol",":id"],["space"," "],["operator","="],["operator",">"],["space"," "],["instance_variable","@id"],["operator",","],["space"," "],["symbol",":name"],["space"," "],["operator","="],["operator",">"],["space"," "],["instance_variable","@name"],["operator",","],["space"," "],["symbol",":icon"],["space"," "],["operator","="],["operator",">"],["space"," "],["instance_variable","@id"],["operator",","],["space"," "],["operator","&"],["ident","block"],["operator",")"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["keyword","end"],["space","\n"],["space","\n"],["keyword","class"],["space"," "],["class","Checkpoint"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":origin_id"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":id"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":parents"],["operator",","],["space"," "],["symbol",":children"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":deep"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","initialize"],["operator","("],["ident","id"],["operator",","],["space"," "],["ident","xnode"],["operator",")"],["space","\n"],["space","    "],["instance_variable","@origin_id"],["space"," "],["operator","="],["space"," "],["ident","xnode"],["operator","["],["delimiter","'"],["content","id"],["delimiter","'"],["operator","]"],["space","\n"],["space","    "],["instance_variable","@id"],["space"," "],["operator","="],["space"," "],["ident","id"],["space","\n"],["space","\n"],["space","    "],["instance_variable","@parents"],["space"," "],["operator","="],["space"," "],["operator","["],["operator","]"],["space","\n"],["space","    "],["instance_variable","@children"],["space"," "],["operator","="],["space"," "],["operator","["],["operator","]"],["space","\n"],["space","\n"],["space","    "],["instance_variable","@deep"],["space"," "],["operator","="],["space"," "],["integer","1"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","build"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","    "],["ident","builder"],["operator","."],["ident","checkpoint"],["operator","("],["symbol",":id"],["space"," "],["operator","="],["operator",">"],["space"," "],["instance_variable","@id"],["operator",")"],["space"," "],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","learned_nodes"],["space","\n"],["space","    "],["instance_variable","@nodes"],["space"," "],["operator","="],["space"," "],["operator","["],["operator","]"],["space","\n"],["space","    "],["instance_variable","@parents"],["operator","."],["ident","each"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","p"],["operator","|"],["space","\n"],["space","      "],["ident","_r_learned"],["operator","("],["ident","p"],["operator",")"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","    "],["instance_variable","@nodes"],["operator","."],["ident","uniq"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","_r_learned"],["operator","("],["ident","node"],["operator",")"],["space","\n"],["space","    "],["instance_variable","@nodes"],["space"," "],["operator","<<"],["space"," "],["ident","node"],["space","\n"],["space","    "],["ident","node"],["operator","."],["ident","parents"],["operator","."],["ident","each"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","p"],["operator","|"],["space","\n"],["space","      "],["ident","_r_learned"],["operator","("],["ident","p"],["operator",")"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","name"],["space","\n"],["space","    "],["instance_variable","@id"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["keyword","end"],["space","\n"],["space","\n"],["keyword","class"],["space"," "],["class","Node"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":origin_id"],["space","\n"],["space","  "],["ident","attr_accessor"],["space"," "],["symbol",":id"],["operator",","],["space"," "],["symbol",":name"],["operator",","],["space"," "],["symbol",":desc"],["operator",","],["space"," "],["symbol",":required"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","initialize"],["operator","("],["ident","id"],["operator",","],["space"," "],["ident","xml_node"],["operator",")"],["space","\n"],["space","    "],["instance_variable","@origin_id"],["space"," "],["operator","="],["space"," "],["ident","xml_node"],["operator","["],["delimiter","'"],["content","id"],["delimiter","'"],["operator","]"],["space","\n"],["space","    "],["instance_variable","@id"],["space"," "],["operator","="],["space"," "],["ident","id"],["space","\n"],["space","    "],["instance_variable","@name"],["space"," "],["operator","="],["space"," "],["ident","xml_node"],["operator","."],["ident","at_css"],["operator","("],["delimiter","'"],["content","y|NodeLabel"],["delimiter","'"],["operator",")"],["operator","."],["ident","children"],["operator","."],["ident","first"],["space","\n"],["space","    "],["space","\n"],["space","    "],["ident","d5"],["space"," "],["operator","="],["space"," "],["ident","xml_node"],["operator","."],["ident","at_css"],["operator","("],["delimiter","'"],["content","data[key=d5]"],["delimiter","'"],["operator",")"],["space","\n"],["space","    "],["instance_variable","@desc"],["space"," "],["operator","="],["space"," "],["ident","d5"],["operator","."],["ident","text"],["space"," "],["keyword","if"],["space"," "],["ident","d5"],["space","\n"],["space","    "],["space","\n"],["space","    "],["instance_variable","@required"],["space"," "],["operator","="],["space"," "],["operator","("],["ident","xml_node"],["operator","."],["ident","at_css"],["operator","("],["delimiter","'"],["content","y|Shape"],["delimiter","'"],["operator",")"],["operator","["],["delimiter","'"],["content","type"],["delimiter","'"],["operator","]"],["space"," "],["operator","=="],["space"," "],["delimiter","'"],["content","roundrectangle"],["delimiter","'"],["operator",")"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","build"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","    "],["ident","builder"],["operator","."],["ident","node"],["operator","("],["symbol",":id"],["space"," "],["operator","="],["operator",">"],["space"," "],["instance_variable","@id"],["operator",","],["space"," "],["symbol",":name"],["space"," "],["operator","="],["operator",">"],["space"," "],["instance_variable","@name"],["operator",","],["space"," "],["symbol",":required"],["space"," "],["operator","="],["operator",">"],["space"," "],["instance_variable","@required"],["operator",")"],["space"," "],["operator","{"],["space","\n"],["space","      "],["ident","builder"],["operator","."],["ident","desc"],["space"," "],["instance_variable","@desc"],["space"," "],["keyword","if"],["space"," "],["instance_variable","@desc"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["keyword","end"],["space","\n"],["space","\n"],["keyword","class"],["space"," "],["class","KnowledgeXmlParser"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","initialize"],["operator","("],["ident","file_path"],["operator",")"],["space","\n"],["space","    "],["ident","str"],["space"," "],["operator","="],["space"," "],["constant","File"],["operator","."],["ident","new"],["operator","("],["ident","file_path"],["operator",")"],["operator","."],["ident","read"],["space","\n"],["space","    "],["ident","str"],["operator","."],["ident","gsub!"],["space"," "],["delimiter","'"],["content","yfiles.foldertype"],["delimiter","'"],["operator",","],["space"," "],["delimiter","'"],["content","yfiles_foldertype"],["delimiter","'"],["space","\n"],["space","\n"],["space","    "],["instance_variable","@file_xml"],["space"," "],["operator","="],["space"," "],["constant","Nokogiri"],["operator","::"],["constant","XML"],["space"," "],["ident","str"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","_groups"],["space","\n"],["space","    "],["instance_variable","@file_xml"],["operator","."],["ident","css"],["operator","("],["delimiter","'"],["content","graphml > graph > node[yfiles_foldertype=\"group\"]"],["delimiter","'"],["operator",")"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","_checkpoints"],["space","\n"],["space","    "],["instance_variable","@file_xml"],["operator","."],["ident","css"],["operator","("],["delimiter","'"],["content","graphml > graph > node:not([yfiles_foldertype=\"group\"])"],["delimiter","'"],["operator",")"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","parse_sets"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","    "],["ident","builder"],["operator","."],["ident","sets"],["space"," "],["operator","{"],["space","\n"],["space","      "],["ident","_groups"],["operator","."],["ident","each"],["space"," "],["keyword","do"],["space"," "],["operator","|"],["ident","xgroup"],["operator","|"],["space","\n"],["space","        "],["ident","set"],["space"," "],["operator","="],["space"," "],["constant","Set"],["operator","."],["ident","new"],["space"," "],["ident","_newid"],["operator","("],["delimiter","'"],["content","set"],["delimiter","'"],["operator",")"],["operator",","],["space"," "],["ident","xgroup"],["space","\n"],["space","        "],["instance_variable","@origin_node_hash"],["operator","["],["ident","set"],["operator","."],["ident","origin_id"],["operator","]"],["space"," "],["operator","="],["space"," "],["ident","set"],["space","\n"],["space","        "],["ident","set"],["operator","."],["ident","build"],["operator","("],["ident","builder"],["operator",")"],["space"," "],["operator","{"],["space","\n"],["space","          "],["ident","parse_set_nodes"],["operator","("],["ident","xgroup"],["operator",","],["space"," "],["ident","builder"],["operator",")"],["space","\n"],["space","          "],["ident","parse_set_nodes_relations"],["operator","("],["ident","xgroup"],["operator",","],["space"," "],["ident","builder"],["operator",")"],["space","\n"],["space","        "],["operator","}"],["space","\n"],["space","\n"],["space","        "],["instance_variable","@sets"],["space"," "],["operator","<<"],["space"," "],["ident","set"],["space","\n"],["space","      "],["keyword","end"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","parse_checkpoints"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","    "],["ident","builder"],["operator","."],["ident","checkpoints"],["space"," "],["operator","{"],["space","\n"],["space","      "],["ident","_checkpoints"],["operator","."],["ident","each"],["space"," "],["keyword","do"],["space"," "],["operator","|"],["ident","xcp"],["operator","|"],["space","\n"],["space","        "],["ident","checkpoint"],["space"," "],["operator","="],["space"," "],["constant","Checkpoint"],["operator","."],["ident","new"],["space"," "],["ident","_newid"],["operator","("],["delimiter","'"],["content","checkpoint"],["delimiter","'"],["operator",")"],["operator",","],["space"," "],["ident","xcp"],["space","\n"],["space","        "],["instance_variable","@origin_node_hash"],["operator","["],["ident","checkpoint"],["operator","."],["ident","origin_id"],["operator","]"],["space"," "],["operator","="],["space"," "],["ident","checkpoint"],["space","\n"],["space","        "],["ident","checkpoint"],["operator","."],["ident","build"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","\n"],["space","        "],["instance_variable","@checkpoints"],["space"," "],["operator","<<"],["space"," "],["ident","checkpoint"],["space","\n"],["space","      "],["keyword","end"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","parse_relations"],["space","\n"],["space","    "],["ident","xedges"],["space"," "],["operator","="],["space"," "],["operator","("],["instance_variable","@sets"],["space"," "],["operator","+"],["space"," "],["instance_variable","@checkpoints"],["operator",")"],["operator","."],["ident","map"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","set"],["operator","|"],["space","\n"],["space","      "],["ident","origin_id"],["space"," "],["operator","="],["space"," "],["ident","set"],["operator","."],["ident","origin_id"],["space","\n"],["space","      "],["ident","es"],["space"," "],["operator","="],["space"," "],["instance_variable","@file_xml"],["operator","."],["ident","css"],["operator","("],["delimiter","\""],["content","edge[source='"],["inline_delimiter","#{"],["ident","origin_id"],["inline_delimiter","}"],["content","']"],["delimiter","\""],["operator",")"],["space","\n"],["space","    "],["operator","}"],["operator","."],["ident","flatten"],["space","\n"],["space","\n"],["space","    "],["instance_variable","@relations"],["space"," "],["operator","="],["space"," "],["ident","xedges"],["operator","."],["ident","map"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","xedge"],["operator","|"],["space","\n"],["space","      "],["ident","source"],["space"," "],["operator","="],["space"," "],["instance_variable","@origin_node_hash"],["operator","["],["ident","xedge"],["operator","["],["delimiter","'"],["content","source"],["delimiter","'"],["operator","]"],["operator","]"],["space","\n"],["space","      "],["ident","target"],["space"," "],["operator","="],["space"," "],["instance_variable","@origin_node_hash"],["operator","["],["ident","xedge"],["operator","["],["delimiter","'"],["content","target"],["delimiter","'"],["operator","]"],["operator","]"],["space","\n"],["space","\n"],["space","      "],["ident","target"],["operator","."],["ident","parents"],["space"," "],["operator","<<"],["space"," "],["ident","source"],["space","\n"],["space","      "],["ident","source"],["operator","."],["ident","children"],["space"," "],["operator","<<"],["space"," "],["ident","target"],["space","\n"],["space","\n"],["space","      "],["operator","{"],["space","\n"],["space","        "],["symbol",":source"],["space"," "],["operator","="],["operator",">"],["space"," "],["ident","source"],["operator",","],["space","\n"],["space","        "],["symbol",":target"],["space"," "],["operator","="],["operator",">"],["space"," "],["ident","target"],["space","\n"],["space","      "],["operator","}"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","build_relations"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","    "],["ident","builder"],["operator","."],["ident","relations"],["space"," "],["operator","{"],["space","\n"],["space","      "],["instance_variable","@relations"],["operator","."],["ident","each"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","relation"],["operator","|"],["space","\n"],["space","        "],["ident","builder"],["operator","."],["ident","send"],["operator","("],["space","\n"],["space","          "],["delimiter","'"],["content","parent-child"],["delimiter","'"],["operator",","],["space"," "],["symbol",":parent"],["space"," "],["operator","="],["operator",">"],["space"," "],["ident","relation"],["operator","["],["symbol",":source"],["operator","]"],["operator","."],["ident","id"],["operator",","],["space"," "],["space","\n"],["space","                          "],["symbol",":child"],["space","  "],["operator","="],["operator",">"],["space"," "],["ident","relation"],["operator","["],["symbol",":target"],["operator","]"],["operator","."],["ident","id"],["space","\n"],["space","        "],["operator",")"],["space","\n"],["space","      "],["operator","}"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","parse_set_nodes"],["operator","("],["ident","group"],["operator",","],["space"," "],["ident","builder"],["operator",")"],["space","\n"],["space","    "],["ident","builder"],["operator","."],["ident","nodes"],["space"," "],["operator","{"],["space","\n"],["space","      "],["ident","group"],["operator","."],["ident","css"],["operator","("],["delimiter","'"],["content","> graph > node"],["delimiter","'"],["operator",")"],["operator","."],["ident","each"],["space"," "],["keyword","do"],["space"," "],["operator","|"],["ident","xnode"],["operator","|"],["space","\n"],["space","        "],["ident","node"],["space"," "],["operator","="],["space"," "],["constant","Node"],["operator","."],["ident","new"],["space"," "],["ident","_newid"],["operator","("],["delimiter","'"],["content","node"],["delimiter","'"],["operator",")"],["operator",","],["space"," "],["ident","xnode"],["space","\n"],["space","        "],["instance_variable","@origin_node_hash"],["operator","["],["ident","node"],["operator","."],["ident","origin_id"],["operator","]"],["space"," "],["operator","="],["space"," "],["ident","node"],["space","\n"],["space","        "],["ident","node"],["operator","."],["ident","build"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","      "],["keyword","end"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","parse_set_nodes_relations"],["operator","("],["ident","xgroup"],["operator",","],["space"," "],["ident","builder"],["operator",")"],["space","\n"],["space","    "],["ident","xedges"],["space"," "],["operator","="],["space"," "],["ident","xgroup"],["operator","."],["ident","css"],["operator","("],["delimiter","'"],["content","> graph > node"],["delimiter","'"],["operator",")"],["operator","."],["ident","map"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","xnode"],["operator","|"],["space","\n"],["space","      "],["ident","origin_id"],["space"," "],["operator","="],["space"," "],["ident","xnode"],["operator","["],["delimiter","'"],["content","id"],["delimiter","'"],["operator","]"],["space","\n"],["space","      "],["ident","es"],["space"," "],["operator","="],["space"," "],["instance_variable","@file_xml"],["operator","."],["ident","css"],["operator","("],["delimiter","\""],["content","edge[source='"],["inline_delimiter","#{"],["ident","origin_id"],["inline_delimiter","}"],["content","']"],["delimiter","\""],["operator",")"],["space","\n"],["space","    "],["operator","}"],["operator","."],["ident","flatten"],["space","\n"],["space","\n"],["space","    "],["ident","builder"],["operator","."],["ident","send"],["operator","("],["delimiter","'"],["content","nodes-relations"],["delimiter","'"],["operator",")"],["space"," "],["operator","{"],["space","\n"],["space","      "],["ident","xedges"],["operator","."],["ident","each"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","xedge"],["operator","|"],["space","\n"],["space","        "],["ident","source"],["space"," "],["operator","="],["space"," "],["instance_variable","@origin_node_hash"],["operator","["],["ident","xedge"],["operator","["],["delimiter","'"],["content","source"],["delimiter","'"],["operator","]"],["operator","]"],["space","\n"],["space","        "],["ident","target"],["space"," "],["operator","="],["space"," "],["instance_variable","@origin_node_hash"],["operator","["],["ident","xedge"],["operator","["],["delimiter","'"],["content","target"],["delimiter","'"],["operator","]"],["operator","]"],["space","\n"],["space","\n"],["space","        "],["ident","builder"],["operator","."],["ident","send"],["operator","("],["delimiter","'"],["content","parent-child"],["delimiter","'"],["operator",","],["space"," "],["symbol",":parent"],["space"," "],["operator","="],["operator",">"],["space"," "],["ident","source"],["operator","."],["ident","id"],["operator",","],["space"," "],["symbol",":child"],["space"," "],["operator","="],["operator",">"],["space"," "],["ident","target"],["operator","."],["ident","id"],["operator",")"],["space","\n"],["space","      "],["operator","}"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","_compute_deep"],["operator","("],["ident","node"],["operator",")"],["space","\n"],["space","    "],["ident","parents_max_deep"],["space"," "],["operator","="],["space"," "],["ident","node"],["operator","."],["ident","parents"],["operator","."],["ident","map"],["operator","("],["operator","&"],["symbol",":deep"],["operator",")"],["operator","."],["ident","max"],["space","\n"],["space","    "],["ident","node"],["operator","."],["ident","deep"],["space"," "],["operator","="],["space"," "],["ident","parents_max_deep"],["space"," "],["operator","+"],["space"," "],["integer","1"],["space","\n"],["space","\n"],["space","    "],["ident","node"],["operator","."],["ident","children"],["operator","."],["ident","each"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","child"],["operator","|"],["space","\n"],["space","      "],["ident","_compute_deep"],["operator","("],["ident","child"],["operator",")"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["keyword","def"],["space"," "],["method","output"],["operator","("],["ident","output_file_path"],["operator",")"],["space","\n"],["space","    "],["instance_variable","@origin_node_hash"],["space"," "],["operator","="],["space"," "],["operator","{"],["operator","}"],["space","\n"],["space","    "],["instance_variable","@sets"],["space"," "],["operator","="],["space"," "],["operator","["],["operator","]"],["space","\n"],["space","    "],["instance_variable","@checkpoints"],["space"," "],["operator","="],["space"," "],["operator","["],["operator","]"],["space","\n"],["space","\n"],["space","    "],["ident","output_builder"],["space"," "],["operator","="],["space"," "],["constant","Nokogiri"],["operator","::"],["constant","XML"],["operator","::"],["constant","Builder"],["operator","."],["ident","new"],["operator","("],["symbol",":encoding"],["space"," "],["operator","="],["operator",">"],["space"," "],["delimiter","'"],["content","UTF-8"],["delimiter","'"],["operator",")"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","builder"],["operator","|"],["space","\n"],["space","      "],["ident","builder"],["operator","."],["ident","send"],["operator","("],["delimiter","'"],["content","knowledge-field"],["delimiter","'"],["operator",")"],["space"," "],["operator","{"],["space","\n"],["space","        "],["ident","parse_sets"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","        "],["ident","parse_checkpoints"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","\n"],["space","        "],["ident","parse_relations"],["space","\n"],["space","        "],["ident","build_relations"],["operator","("],["ident","builder"],["operator",")"],["space","\n"],["space","      "],["operator","}"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","\n"],["space","    "],["instance_variable","@relations"],["operator","."],["ident","each"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","relation"],["operator","|"],["space","\n"],["space","      "],["ident","_compute_deep"],["operator","("],["ident","relation"],["operator","["],["symbol",":target"],["operator","]"],["operator",")"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","\n"],["space","    "],["instance_variable","@sets"],["operator","."],["ident","each"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","set"],["operator","|"],["space","\n"],["space","      "],["ident","node"],["space"," "],["operator","="],["space"," "],["ident","output_builder"],["operator","."],["ident","doc"],["operator","."],["ident","at_css"],["operator","("],["delimiter","\""],["content","set[id='"],["inline_delimiter","#{"],["ident","set"],["operator","."],["ident","id"],["inline_delimiter","}"],["content","']"],["delimiter","\""],["operator",")"],["space","\n"],["space","      "],["ident","node"],["operator","["],["delimiter","'"],["content","deep"],["delimiter","'"],["operator","]"],["space"," "],["operator","="],["space"," "],["ident","set"],["operator","."],["ident","deep"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","\n"],["space","    "],["instance_variable","@checkpoints"],["operator","."],["ident","each"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","cp"],["operator","|"],["space","\n"],["space","      "],["ident","node"],["space"," "],["operator","="],["space"," "],["ident","output_builder"],["operator","."],["ident","doc"],["operator","."],["ident","at_css"],["operator","("],["delimiter","\""],["content","checkpoint[id='"],["inline_delimiter","#{"],["ident","cp"],["operator","."],["ident","id"],["inline_delimiter","}"],["content","']"],["delimiter","\""],["operator",")"],["space","\n"],["space","      "],["ident","node"],["operator","["],["delimiter","'"],["content","deep"],["delimiter","'"],["operator","]"],["space"," "],["operator","="],["space"," "],["ident","cp"],["operator","."],["ident","deep"],["space","\n"],["space","\n"],["space","      "],["constant","Nokogiri"],["operator","::"],["constant","XML"],["operator","::"],["constant","Builder"],["operator","."],["ident","with"],["operator","("],["ident","node"],["operator",")"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","builder"],["operator","|"],["space","\n"],["space","        "],["ident","cp"],["operator","."],["ident","learned_nodes"],["operator","."],["ident","each"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","u"],["operator","|"],["space","\n"],["space","          "],["ident","builder"],["operator","."],["ident","learned"],["operator","("],["symbol",":target"],["space"," "],["operator","="],["operator",">"],["space"," "],["ident","u"],["operator","."],["ident","id"],["operator",")"],["space","\n"],["space","        "],["operator","}"],["space","\n"],["space","      "],["operator","}"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","\n"],["space","    "],["ident","output_str"],["space"," "],["operator","="],["space"," "],["ident","output_builder"],["operator","."],["ident","to_xml"],["operator","("],["symbol",":encoding"],["space"," "],["operator","="],["operator",">"],["space"," "],["delimiter","'"],["content","UTF-8"],["delimiter","'"],["operator",")"],["space","\n"],["space","\n"],["space","    "],["comment","# puts output_str"],["space","\n"],["space","    "],["comment","# p @origin_group_hash"],["space","\n"],["space","\n"],["space","    "],["constant","File"],["operator","."],["ident","open"],["operator","("],["ident","output_file_path"],["operator",","],["space"," "],["delimiter","'"],["content","w"],["delimiter","'"],["operator",")"],["space"," "],["operator","{"],["space"," "],["operator","|"],["ident","f"],["operator","|"],["space","\n"],["space","      "],["ident","f"],["operator","."],["ident","write"],["operator","("],["ident","output_str"],["operator",")"],["space","\n"],["space","    "],["operator","}"],["space","\n"],["space","  "],["keyword","end"],["space","\n"],["space","\n"],["space","  "],["ident","private"],["space","\n"],["space","    "],["comment","# 产生一个随机字符串"],["space","\n"],["space","    "],["keyword","def"],["space"," "],["method","randstr"],["operator","("],["ident","length"],["space"," "],["operator","="],["space"," "],["integer","6"],["operator",")"],["space","\n"],["space","      "],["ident","base"],["space"," "],["operator","="],["space"," "],["delimiter","'"],["content","abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"],["delimiter","'"],["operator",";"],["space","\n"],["space","      "],["ident","size"],["space"," "],["operator","="],["space"," "],["ident","base"],["operator","."],["ident","size"],["space","\n"],["space","      "],["ident","re"],["space"," "],["operator","="],["space"," "],["delimiter","'"],["delimiter","'"],["space"," "],["operator","<<"],["space"," "],["ident","base"],["operator","["],["ident","rand"],["operator","("],["ident","size"],["operator","-"],["integer","10"],["operator",")"],["operator","]"],["space","\n"],["space","      "],["operator","("],["ident","length"],["space"," "],["operator","-"],["space"," "],["integer","1"],["operator",")"],["operator","."],["ident","times"],["space"," "],["operator","{"],["space","\n"],["space","        "],["ident","re"],["space"," "],["operator","<<"],["space"," "],["ident","base"],["operator","["],["ident","rand"],["operator","("],["ident","size"],["operator",")"],["operator","]"],["space","\n"],["space","      "],["operator","}"],["space","\n"],["space","      "],["ident","re"],["space","\n"],["space","    "],["keyword","end"],["space","\n"],["space","\n"],["space","    "],["keyword","def"],["space"," "],["method","_newid"],["operator","("],["ident","kind"],["operator",")"],["space","\n"],["space","      "],["comment","# \"kind-#{randstr}\""],["space","\n"],["space","      "],["instance_variable","@_id_h"],["space"," "],["operator","="],["space"," "],["constant","Hash"],["operator","."],["ident","new"],["operator","("],["integer","0"],["operator",")"],["space"," "],["keyword","if"],["space"," "],["operator","!"],["instance_variable","@_id_h"],["space","\n"],["space","      "],["instance_variable","@_id_h"],["operator","["],["ident","kind"],["operator","]"],["space"," "],["operator","+="],["space"," "],["integer","1"],["space","\n"],["space","      "],["delimiter","\""],["inline_delimiter","#{"],["ident","kind"],["inline_delimiter","}"],["content","-"],["inline_delimiter","#{"],["instance_variable","@_id_h"],["operator","["],["ident","kind"],["operator","]"],["inline_delimiter","}"],["delimiter","\""],["space","\n"],["space","    "],["keyword","end"],["space","\n"],["keyword","end"],["space","\n"],["space","\n"],["ident","input_file_path"],["space"," "],["operator","="],["space"," "],["predefined_constant","ARGV"],["operator","["],["integer","0"],["operator","]"],["space","\n"],["ident","output_file_path"],["space"," "],["operator","="],["space"," "],["predefined_constant","ARGV"],["operator","["],["integer","1"],["operator","]"],["space","\n"],["space","\n"],["keyword","if"],["space"," "],["operator","!"],["ident","input_file_path"],["space"," "],["operator","||"],["space"," "],["operator","!"],["ident","output_file_path"],["space","\n"],["space","  "],["ident","p"],["space"," "],["delimiter","'"],["content","参数不正确，请按 ruby parse.rb <输入文件> <输出文件> 来执行"],["delimiter","'"],["space","\n"],["space","  "],["keyword","return"],["space","\n"],["keyword","end"],["space","\n"],["space","\n"],["constant","KnowledgeXmlParser"],["operator","."],["ident","new"],["operator","("],["ident","input_file_path"],["operator",")"],["operator","."],["ident","output"],["operator","("],["ident","output_file_path"],["operator",")"]]